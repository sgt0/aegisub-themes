function K(e){return Array.from(new Set(e))}function y(e,n){const t=Q();return t[e]??(t[e]=n)}function Q(){var e;return globalThis._vike??(globalThis._vike={}),(e=globalThis._vike).globals??(e.globals={}),globalThis._vike.globals}const u=new Proxy({},{get:(e,n)=>t=>n==="code"?`\`${t}\``:n==="string"?`'${t}'`:t}),O="0.4.246";let h;h??(h=_());function _(){return y("utils/assertSingleInstance.ts",{instances:[],alreadyLogged:new Set})}function T(){return h??(h=_()),h}const X="Client runtime of both Server Routing and Client Routing loaded https://vike.dev/client-runtimes-conflict",A="Client runtime loaded twice https://vike.dev/client-runtime-duplicated";function G(){const e=T();{const n=K(e.instances);p(n.length<=1,`vike@${u.bold(n[0])} and vike@${u.bold(n[1])} loaded which is highly discouraged, see ${u.underline("https://vike.dev/warning/version-mismatch")}`,{onlyOnce:!0,showStackTrace:!1})}e.checkSingleInstance&&e.instances.length>1&&p(!1,A,{onlyOnce:!0,showStackTrace:!0})}function ke(e){const n=T();p(n.isClientRouting!==!1,X,{onlyOnce:!0,showStackTrace:!0}),p(n.isClientRouting===void 0,A,{onlyOnce:!0,showStackTrace:!0}),n.isClientRouting=!0,n.checkSingleInstance=!0,G()}function Z(){T().instances.push(O),G()}function p(e,n,{onlyOnce:t,showStackTrace:o}){const r=T();if(e)return;const i=`[Vike][Warning] ${n}`;{const{alreadyLogged:s}=r,a=i;if(s.has(a))return;s.add(a)}console.warn(o?new Error(i):i)}function N(){return!(typeof process>"u"||!process.cwd||!process.versions||typeof process.versions.node>"u"||!process.release||process.release.name!=="node")}function b(e,n){const t=new Error(e);return N()&&(t.stack=M(t.stack,n)),t}function M(e,n){if(!e)return e;const t=ne(e);let o=0;return t.filter(i=>i.includes(" (internal/")||i.includes(" (node:internal")?!1:o<n&&ee(i)?(o++,!1):!0).join(`
`)}function ee(e){return e.startsWith("    at ")}function ne(e){return e.split(/\r?\n/)}function P(e){return typeof e=="object"&&e!==null}const c=y("utils/assert.ts",{alreadyLogged:new Set,logger(e,n){n==="info"?console.log(e):console.warn(e)},showStackTraceList:new WeakSet});Z();const te="[vike]",oe=`[vike@${O}]`,re="Bug",m=2;function g(e,n){var s;if(e)return;const t=(()=>{if(!n)return null;const a=typeof n=="string"?n:JSON.stringify(n);return u.dim(`Debug info for Vike maintainers (you can ignore this): ${a}`)})();let r=[`You stumbled upon a Vike bug. Go to ${u.underline("https://github.com/vikejs/vike/issues/new?template=bug.yml")} and copy-paste this error. A maintainer will fix the bug (usually within 24 hours).`,t].filter(Boolean).join(" ");r=k(r),r=$(r,re),r=w(r,!0);const i=b(r,m);throw(s=c.onBeforeLog)==null||s.call(c),i}function d(e,n,{showStackTrace:t,exitOnError:o}={}){var i;if(e)return;t=t||c.alwaysShowStackTrace,n=k(n),n=$(n,"Wrong Usage"),n=w(n);const r=b(n,m);if(t&&c.showStackTraceList.add(r),(i=c.onBeforeLog)==null||i.call(c),o)console.error(t?r:n),process.exit(1);else throw r}function ie(e){return e=k(e),e=$(e,"Error"),e=w(e),b(e,m)}function se(e,n,{onlyOnce:t,showStackTrace:o}){var r;if(!e){if(o=o||c.alwaysShowStackTrace,n=k(n),n=$(n,"Warning"),n=w(n),t){const{alreadyLogged:i}=c,s=t===!0?n:t;if(i.has(s))return;i.add(s)}if((r=c.onBeforeLog)==null||r.call(c),o){const i=b(n,m);c.showStackTraceList.add(i),c.logger(i,"warn")}else c.logger(n,"warn")}}function we(e,n,{onlyOnce:t}){var o;n=k(n),n=w(n);{const{alreadyLogged:r}=c,i=n;if(r.has(i))return;r.add(i)}(o=c.onBeforeLog)==null||o.call(c),c.logger(n,"info")}function $(e,n){let t=`[${n}]`;const o=n==="Warning"?"yellow":"red";return t=u.bold(u[o](t)),`${t}${e}`}function k(e){return e.startsWith("[")?e:` ${e}`}function w(e,n=!1){return`${n?oe:te}${e}`}function W(e){const n=e/1e3;if(n<120){const t=L(n);return`${t} second${R(t)}`}{const t=n/60,o=L(t);return`${o} minute${R(o)}`}}function L(e){let n=e.toFixed(1);return n.endsWith(".0")&&(n=n.slice(0,-2)),n}function R(e){return e==="1"?"":"s"}function ae(e){return e instanceof Function||typeof e=="function"}function I(e){return Array.isArray(e)}function pe(e,n){const t=n.find(o=>o.pageId===e);return n.length>0,t}function ce(e){if(!e||I(e)||e.definedBy)return null;const{filePathToShowToUser:n}=e;return n}function V(e){return ce(e)}const ue=y("hooks/getHook.ts",{});function ye(e,n){if(!(n in e.exports))return null;const{hooksTimeout:t}=e.config,o=D(t,n),r=e.exports[n];if(r===null)return null;const i=e.exportsAll[n][0];i.exportValue;const s=i.filePath;return v(r,n,s,o)}function le(e,n){var i;const{hooksTimeout:t}=n.config,o=D(t,e),r=[];return(i=n.exportsAll[e])==null||i.forEach(s=>{const a=s.exportValue;if(a===null)return;const l=s.filePath;r.push(v(a,e,l,o))}),r}function Te(e,n){const t=e.configValues[n];if(!(t!=null&&t.value))return null;const{hookFn:o,hookFilePath:r}=de(t),i=B(n);return v(o,n,r,i)}function fe(e,n){const t=e.configValues[n];return t!=null&&t.value?t.value.map((r,i)=>{const s=r,a=B(n);I(t.definedAtData);const l=V(t.definedAtData[i]);return v(s,n,l,a)}):[]}function B(e){return z(e)}function v(e,n,t,o){return ge(e,{hookName:n,hookFilePath:t}),{hookFn:e,hookName:n,hookFilePath:t,hookTimeout:o}}function de(e){const n=e.value,t=V(e.definedAtData);return{hookFn:n,hookFilePath:t}}function ge(e,{hookName:n,hookFilePath:t}){n.endsWith(")"),t.endsWith(" "),d(ae(e),`Hook ${n}() defined by ${t} should be a function`)}function D(e,n){const t=he(e);if(t===!1)return{error:!1,warning:!1};const o=t[n],r=z(n);return(o==null?void 0:o.error)!==void 0&&(r.error=o.error),(o==null?void 0:o.warning)!==void 0&&(r.warning=o.warning),r}function he(e){if(e===void 0)return{};if(e===!1)return!1;d(P(e),`Setting ${u.cyan("hooksTimeout")} should be ${u.cyan("false")} or an object`);const n={};return Object.entries(e).forEach(([t,o])=>{if(o===!1){n[t]={error:!1,warning:!1};return}d(P(o),`Setting ${u.cyan(`hooksTimeout.${t}`)} should be ${u.cyan("false")} or an object`);const[r,i]=["error","warning"].map(s=>{const a=o[s];if(a===void 0||a===!1)return a;const l=`Setting ${u.cyan(`hooksTimeout.${t}.${s}`)} should be`;return d(typeof a=="number",`${l} ${u.cyan("false")} or a number`),d(a>0,`${l} a positive number`),a});n[t]={error:r,warning:i}}),n}function z(e){return e==="onBeforeRoute"?{error:5*1e3,warning:1*1e3}:ue.isPrerendering?{error:2*60*1e3,warning:30*1e3}:(e.toLowerCase().includes("prerender"),{error:30*1e3,warning:4*1e3})}const x=y("utils/execHook.ts",{userHookErrors:new WeakMap,pageContext:null});async function be(e,n,t){const o=le(e,n);return await U(o,n,t)}async function me(e,n,t,o,r){const i=fe(n,e),s=r(o);await Promise.all(i.map(async a=>{await J(()=>a.hookFn(s),a,t)}))}async function U(e,n,t){if(!e.length)return[];const o=t(n);return await Promise.all(e.map(async i=>{const s=await J(()=>i.hookFn(o),i,o);return{...i,hookReturn:s}}))}async function $e(e,n,t){const o=await U([e],n,t),{hookReturn:r}=o[0];d(r===void 0,`The ${e.hookName}() hook defined by ${e.hookFilePath} isn't allowed to return a value`)}function J(e,n,t){const{hookName:o,hookFilePath:r,hookTimeout:{error:i,warning:s}}=n;let a,l;const q=new Promise((f,Y)=>{a=S=>{C(),f(S)},l=S=>{C(),Y(S)}}),C=()=>{H&&clearTimeout(H),j&&clearTimeout(j)},H=E(s)&&setTimeout(()=>{se(!1,`The ${o}() hook defined by ${r} is slow: it's taking more than ${W(s)} (https://vike.dev/hooksTimeout)`,{onlyOnce:!1})},s),j=E(i)&&setTimeout(()=>{const f=ie(`The ${o}() hook defined by ${r} timed out: it didn't finish after ${W(i)} (https://vike.dev/hooksTimeout)`);l(f)},i);return(async()=>{try{F(t);const f=await e();a(f)}catch(f){P(f)&&x.userHookErrors.set(f,{hookName:o,hookFilePath:r}),l(f)}})(),q}function ve(e,n,t){const o=t(n);return F(o),{hookReturn:e.hookFn(o)}}function E(e){return!!e&&e!==1/0}function Se(e){F(e)}function F(e){x.pageContext=e,Promise.resolve().then(()=>{x.pageContext=null})}export{g as a,d as b,u as c,P as d,ae as e,se as f,y as g,ye as h,I as i,$e as j,z as k,ie as l,pe as m,be as n,ce as o,Se as p,fe as q,me as r,ve as s,Te as t,K as u,we as v,le as w,U as x,ke as y};
